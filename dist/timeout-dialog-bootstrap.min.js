/*
 * timeout-dialog-bootstrap.js v1.0.0, 03-21-2016
 * 
 * Copyright for portions of timeout-dialog-bootstrap.js are held by Rodrigo Neri (@rigoneri) 
 * as part of project timeout-dialog.js. All other copyright for project 
 * timeout-dialog-bootstrap.js are held by Stephen Womack, 2016.
 * 
 * (The MIT License)
 */
String.prototype.format=function(){for(var t=this,o=arguments.length;o--;)t=t.replace(new RegExp("\\{"+o+"\\}","gm"),arguments[o]);return t},!function(t){t.timeoutDialog=function(o){var n={timeout:1200,countdown:60,title:"Your session is about to expire!",message:"You will be logged out in {0}.",question:"Do you want to stay signed in?",keep_alive_button_text:"Yes, Keep me signed in",sign_out_button_text:"No, Sign me out",keep_alive_url:"/keep-alive",logout_url:null,logout_redirect_url:"/",restart_on_yes:!0};t.extend(n,o);var e={init:function(){this.setupDialogTimer()},setupDialogTimer:function(){var t=this;window.setTimeout(function(){t.setupDialog()},1e3*(n.timeout-n.countdown))},setupDialog:function(){var t=this;t.destroyDialog(),bootbox.dialog({closeButton:!1,message:n.message.format(t.getTimeString(n.countdown))+"<br />"+n.question,title:n.title,buttons:{stayLoggedIn:{label:n.keep_alive_button_text,className:"btn-primary",callback:function(){t.keepAlive()}},signOut:{label:n.sign_out_button_text,className:"btn-main",callback:function(){t.signOut(!0)}}}}),t.startCountdown()},destroyDialog:function(){t("#timeout-dialog").length&&(t(this).dialog("close"),t("#timeout-dialog").remove())},getTimeString:function(t){var o=Math.floor(t/60),n=t-60*o,e="";return e='<span id="timeout-countdown">',o>0&&(e+=o+" minutes "),e+=n+" seconds </span>"},startCountdown:function(){var o=this,e=n.countdown;this.countdown=window.setInterval(function(){e-=1,t("#timeout-countdown").html(o.getTimeString(e)),0>=e&&(window.clearInterval(o.countdown),o.signOut(!1))},1e3)},keepAlive:function(){var o=this;this.destroyDialog(),window.clearInterval(this.countdown),t.get(n.keep_alive_url,function(t){"OK"===t?n.restart_on_yes&&o.setupDialogTimer():o.signOut(!1)}).fail(function(){o.signOut(!1)})},signOut:function(o){var e=this;this.destroyDialog(),null!==n.logout_url?t.post(n.logout_url,function(t){e.redirectLogout(o)}).fail(function(t){console.log(t)}):e.redirectLogout(o)},redirectLogout:function(t){var o=n.logout_redirect_url+"?next="+encodeURIComponent(window.location.pathname+window.location.search);t||(o+="&timeout=t"),window.location=o}};e.init()}}(window.jQuery);