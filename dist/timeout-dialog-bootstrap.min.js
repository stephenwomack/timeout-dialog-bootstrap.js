/*
 * timeout-dialog-bootstrap.js v1.0.0, 03-21-2016
 * 
 * Copyright for portions of timeout-dialog-bootstrap.js are held by Rodrigo Neri (@rigoneri) 
 * as part of project timeout-dialog.js. All other copyright for project 
 * timeout-dialog-bootstrap.js are held by Stephen Womack, 2016.
 * 
 * (The MIT License)
 */
String.prototype.format=function(){for(var a=this,b=arguments.length;b--;)a=a.replace(new RegExp("\\{"+b+"\\}","gm"),arguments[b]);return a},!function(a){a.timeoutDialog=function(b){var c={timeout:1200,countdown:60,title:"Your session is about to expire!",message:"You will be logged out in {0}.",question:"Do you want to stay signed in?",keep_alive_button_text:"Yes, Keep me signed in",sign_out_button_text:"No, Sign me out",keep_alive_url:"/keep-alive",logout_url:null,logout_redirect_url:"/",restart_on_yes:!0};a.extend(c,b);var d={init:function(){this.setupDialogTimer()},setupDialogTimer:function(){var a=this;window.setTimeout(function(){a.setupDialog()},1e3*(c.timeout-c.countdown))},setupDialog:function(){var a=this;a.destroyDialog(),bootbox.dialog({closeButton:!1,message:c.message.format(a.getTimeString(c.countdown))+"<br />"+c.question,title:c.title,className:"session-timout-warning",buttons:{stayLoggedIn:{label:c.keep_alive_button_text,className:"btn-primary",callback:function(){a.keepAlive()}},signOut:{label:c.sign_out_button_text,className:"btn-main",callback:function(){a.signOut(!0)}}}}),a.startCountdown()},destroyDialog:function(){a("#timeout-dialog").length&&(a(this).dialog("close"),a("#timeout-dialog").remove())},getTimeString:function(a){var b=Math.floor(a/60),c=a-60*b,d="";return d='<span id="timeout-countdown">',b>0&&(d+=b+" minutes "),d+=c+" seconds</span>"},startCountdown:function(){var b=this,d=c.countdown;this.countdown=window.setInterval(function(){d-=1,a("#timeout-countdown").html(b.getTimeString(d)),d<=0&&(window.clearInterval(b.countdown),b.signOut(!1))},1e3)},keepAlive:function(){var b=this;this.destroyDialog(),window.clearInterval(this.countdown),a.get(c.keep_alive_url,function(a){"OK"===a?c.restart_on_yes&&b.setupDialogTimer():b.signOut(!1)})},signOut:function(b){var d=this;this.destroyDialog(),null!==c.logout_url?a.post(c.logout_url,function(a){d.redirectLogout(b)}).fail(function(a){console.log(a)}):d.redirectLogout(b)},redirectLogout:function(a){var b=c.logout_redirect_url+"?next="+encodeURIComponent(window.location.pathname+window.location.search);a||(b+="&timeout=t"),window.location=b}};d.init()}}(window.jQuery);